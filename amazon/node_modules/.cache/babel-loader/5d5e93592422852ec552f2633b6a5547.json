{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Upgrading\\\\react\\\\Learning_React\\\\amazon\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Upgrading\\\\react\\\\Learning_React\\\\amazon\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Upgrading\\\\react\\\\Learning_React\\\\amazon\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import\"./Payment.css\";import{useStateValue}from\"./StateProvider\";import CheckoutProduct from\"./CheckoutProduct\";import{Link,useHistory}from\"react-router-dom\";import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import CurrencyFormat from\"react-currency-format\";import{getBasketTotal}from\"./reducer\";import axios from'./axios';import{db}from\"./firebase\";import React,{useState,useEffect}from'react';function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var history=useHistory();var stripe=useStripe();var elements=useElements();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),succeeded=_useState2[0],setSucceeded=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),processing=_useState4[0],setProcessing=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){// generate the special stripe secret which allows us to charge a customer\nvar getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'post',// Stripe expects the total in a currencies subunits\nurl:\"/payments/create?total=\".concat(getBasketTotal(basket)*100)});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[basket]);console.log('THE SECRET IS >>>',clientSecret);console.log('ðŸ‘±',user);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// do all the fancy stripe stuff...\nevent.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;// paymentIntent = payment confirmation\ndb.collection('users').doc(user===null||user===void 0?void 0:user.uid).collection('orders').doc(paymentIntent.id).set({basket:basket,amount:paymentIntent.amount,created:paymentIntent.created});setSucceeded(true);setError(null);setProcessing(false);dispatch({type:'EMPTY_BASKET'});history.replace('/orders');});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(event){// Listen for changes in the CardElement\n// and display any errors as the customer types their card details\nsetDisabled(event.empty);setError(event.error?event.error.message:\"\");};return/*#__PURE__*/React.createElement(\"div\",{className:\"payment\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment__container\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Checkout (\",/*#__PURE__*/React.createElement(Link,{to:\"/checkout\"},basket===null||basket===void 0?void 0:basket.length,\" items\"),\")\"),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment__title\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Delivery address\")),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__address\"},/*#__PURE__*/React.createElement(\"p\",null,user===null||user===void 0?void 0:user.email),/*#__PURE__*/React.createElement(\"p\",null,\"Hi-tech City \"),/*#__PURE__*/React.createElement(\"p\",null,\"Hyderabad-Telangana\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment__title\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Review items for delivery\")),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__items\"},basket.map(function(item){return/*#__PURE__*/React.createElement(CheckoutProduct,{id:item.id,title:item.title,image:item.image,price:item.price,rating:item.rating});}))),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__section\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__title\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Payment method\")),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__details\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(CardElement,{onChange:handleChange}),/*#__PURE__*/React.createElement(\"div\",{className:\"payment__priceContainer\"},/*#__PURE__*/React.createElement(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/React.createElement(\"h3\",null,\"Order Total: \",value);},decimalScale:2,value:getBasketTotal(basket),displayType:\"text\",thousandSeparator:true,prefix:\"$\"}),/*#__PURE__*/React.createElement(\"button\",{disabled:processing||disabled||succeeded},/*#__PURE__*/React.createElement(\"span\",null,processing?/*#__PURE__*/React.createElement(\"p\",null,\"Processing\"):\"Buy Now\"))),error&&/*#__PURE__*/React.createElement(\"div\",null,error)))));}export default Payment;","map":{"version":3,"sources":["D:/Upgrading/react/Learning_React/amazon/src/Payment.js"],"names":["useStateValue","CheckoutProduct","Link","useHistory","CardElement","useStripe","useElements","CurrencyFormat","getBasketTotal","axios","db","React","useState","useEffect","Payment","basket","user","dispatch","history","stripe","elements","succeeded","setSucceeded","processing","setProcessing","error","setError","disabled","setDisabled","clientSecret","setClientSecret","getClientSecret","method","url","response","data","console","log","handleSubmit","event","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","collection","doc","uid","id","set","amount","created","type","replace","payload","handleChange","empty","message","length","email","map","item","title","image","price","rating","value"],"mappings":"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","sourcesContent":["import \"./Payment.css\";\r\nimport { useStateValue } from \"./StateProvider\";\r\nimport CheckoutProduct from \"./CheckoutProduct\";\r\nimport { Link,useHistory  } from \"react-router-dom\";\r\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\r\nimport CurrencyFormat from \"react-currency-format\";\r\nimport { getBasketTotal } from \"./reducer\";\r\nimport axios from './axios';\r\nimport { db } from \"./firebase\";\r\nimport React, { useState, useEffect } from 'react';\r\n\r\nfunction Payment() {\r\n  const [{ basket, user }, dispatch] = useStateValue();\r\n  const history = useHistory();\r\n\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const [succeeded, setSucceeded] = useState(false);\r\n  const [processing, setProcessing] = useState(\"\");\r\n  const [error, setError] = useState(null);\r\n  const [disabled, setDisabled] = useState(true);\r\n  const [clientSecret, setClientSecret] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // generate the special stripe secret which allows us to charge a customer\r\n    const getClientSecret = async () => {\r\n        const response = await axios({\r\n            method: 'post',\r\n            // Stripe expects the total in a currencies subunits\r\n            url: `/payments/create?total=${getBasketTotal(basket) * 100}`\r\n        });\r\n        setClientSecret(response.data.clientSecret)\r\n    }\r\n\r\n    getClientSecret();\r\n}, [basket])\r\n\r\nconsole.log('THE SECRET IS >>>', clientSecret)\r\nconsole.log('ðŸ‘±', user)\r\n\r\nconst handleSubmit = async (event) => {\r\n    // do all the fancy stripe stuff...\r\n    event.preventDefault();\r\n    setProcessing(true);\r\n\r\n    const payload = await stripe.confirmCardPayment(clientSecret, {\r\n        payment_method: {\r\n            card: elements.getElement(CardElement)\r\n        }\r\n    }).then(({ paymentIntent }) => {\r\n        // paymentIntent = payment confirmation\r\n\r\n        db\r\n          .collection('users')\r\n          .doc(user?.uid)\r\n          .collection('orders')\r\n          .doc(paymentIntent.id)\r\n          .set({\r\n              basket: basket,\r\n              amount: paymentIntent.amount,\r\n              created: paymentIntent.created\r\n          })\r\n\r\n        setSucceeded(true);\r\n        setError(null)\r\n        setProcessing(false)\r\n\r\n        dispatch({\r\n            type: 'EMPTY_BASKET'\r\n        })\r\n\r\n        history.replace('/orders')\r\n    })\r\n\r\n}\r\n\r\nconst handleChange = event => {\r\n    // Listen for changes in the CardElement\r\n    // and display any errors as the customer types their card details\r\n    setDisabled(event.empty);\r\n    setError(event.error ? event.error.message : \"\");\r\n}\r\n\r\n  return (\r\n    <div className=\"payment\">\r\n      <div className=\"payment__container\">\r\n        <h1>\r\n          Checkout (<Link to=\"/checkout\">{basket?.length} items</Link>)\r\n        </h1>\r\n        <div className=\"payment__section\">\r\n          <div className=\"payment__title\">\r\n            <h3>Delivery address</h3>\r\n          </div>\r\n          <div className=\"payment__address\">\r\n            <p>{user?.email}</p>\r\n            <p>Hi-tech City </p>\r\n            <p>Hyderabad-Telangana</p>\r\n          </div>\r\n        </div>\r\n        <div className=\"payment__section\">\r\n          <div className=\"payment__title\">\r\n            <h3>Review items for delivery</h3>\r\n          </div>\r\n          <div className=\"payment__items\">\r\n            {basket.map((item) => (\r\n              <CheckoutProduct\r\n                id={item.id}\r\n                title={item.title}\r\n                image={item.image}\r\n                price={item.price}\r\n                rating={item.rating}\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <div className=\"payment__section\"></div>\r\n        <div className=\"payment__title\">\r\n          <h3>Payment method</h3>\r\n        </div>\r\n        <div className=\"payment__details\">\r\n          <form onSubmit={handleSubmit}>\r\n            <CardElement onChange={handleChange} />\r\n\r\n            <div className=\"payment__priceContainer\">\r\n              <CurrencyFormat\r\n                renderText={(value) => <h3>Order Total: {value}</h3>}\r\n                decimalScale={2}\r\n                value={getBasketTotal(basket)}\r\n                displayType={\"text\"}\r\n                thousandSeparator={true}\r\n                prefix={\"$\"}\r\n              />\r\n              <button disabled={processing || disabled || succeeded}>\r\n                <span>{processing ? <p>Processing</p> : \"Buy Now\"}</span>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Errors */}\r\n            {error && <div>{error}</div>}\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Payment;\r\n"]},"metadata":{},"sourceType":"module"}